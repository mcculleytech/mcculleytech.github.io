+++
title = "malware analysis"
date = "2025-04-11T15:41:07-05:00"
author = "alex mcculley"
cover = ""
coverCaption = ""
categories = ["low-level-programming"]
tags = ["malware-analysis", ""]
description = ""
showFullContent = false
readingTime = false
hideComments = false
color = "" #color from the theme settings
+++

# overview
In my recent post about [assembly](../asm101/index.md), I mentioned a desire to continue to grow in my understanding of low level programming. As a part of that I took a course on basic malware analysis from Mandiant that me both analyze malware samples both statically and dynamically. During that course I used [IDA Pro](https://hex-rays.com/ida-pro) to decompile some malware and get a look 'under the hood' so to speak at what a particular piece of malware was doing. The preexisting assembly knowledge was great to have for that section of the course. I also took the [Python 201](https://academy.tcm-sec.com/p/python-201-for-hackers) from TCM where the [ctypes](https://docs.python.org/3/library/ctypes.html) was used to interact with the Win32 API to see if I could use my existing python knowledge to interact with Windows at a low level. I decided it'd be a good exercise to meld these two trainings together into a personal project/ exercise and write a piece of malware in Python (I use the term malware loosely), and then analyze it using some of the tools and techniques that I learned in the Mandiant training. Thus this post was born. 

As a brief side note - my subnet changed a few times in my local VMWare network so if you notice different IPs that's the reason why. There's a small chance that I mix up screenshots between the different subnets by accident.

## methodology
For the purposes of this project I wanted something simple since I'm a little out of my element in malware development (it's a work in progress). I decided to write a piece of malware that opens up notepad, allocates memory within that process, writes some shellcode, then executes it. As I stated in the overview, this will be done in python and utilizing the `ctypes` library. The execution will be done on a [commando vm](https://github.com/mandiant/commando-vm) which comes with some analysis tools. 

### writing the 'malware'
The malware writing process involved me taking a deeper dive and reviewing one of the projects outlined in the Python 201 course by TCM where the malware written follows the same flow that I wanted to analyze. To be honest the only real difference is in the shellcode. The msfvenom payload was crafted to make a callback to my attacker machine. 

[Insert Screenshots and source code link here]

As a final step in this exercise - I want to format the malware into an exe to run against my commando vm. Obviously having Python on a Windows machine is non standard so I'd like for it to be more portable and mimic a more 'realistic' piece of malware in format. 

### static analysis



### dynamic analysis

It's important before running the malware in our sandbox environment to take a snapshot of the VM we're running it on. That way any artifacts left behind are wiped away once we restore the VM to it's old snapshot. Once that's done, we need to setup a few tools to capture the behavior of the malware. [FakeNet]() is a tool built by Mandiant that will allow us to fake network activity. 

## closing remarks